<!-- NAVBAR -->
<nav class="navbar">
    <div class="navbar-left">
        <span class="logo">VCad Finantial</span>
    </div>
    <div class="user-menu">
        <img [src]="loadImage()" alt="Usuário" class="user-avatar" (click)="toggleMenu()" />

        <div class="dropdown-menu" [class.show]="menuOpen">
            <button (click)="openUpdateUserModal()">Perfil</button>
            <button (click)="logout()">Sair</button>
        </div>
    </div>
</nav>

<div class="layout">
    <!-- MENU LATERAL -->
    <aside class="sidebar">
        <ul>
            <li>
                <a class="nav-link" routerLink="/account/dashboard" routerLinkActive="active">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            </li>
            <li><i class="bi bi-display"></i> Display</li>
            <li>
                <a class="nav-link" routerLink="/account/report" routerLinkActive="active">
                    <i class="bi bi-journal-text"></i> Relatório de Log
                </a>
            </li>
        </ul>
    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="container">
        <!-- Botão de Importar XML -->
        <div class="import-button-container">
            <button class="btn-import" (click)="triggerFileInput()">
                <i class="bi bi-upload"></i> Importar XML
            </button>
            <input type="file" #fileInput accept=".xml" (change)="handleFileInput($event)" style="display: none" />
        </div>

        <!-- PAINEL DE FILTRO -->
        <div class="panel panel-filter">
            <h3>Filtro</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" class="form-control" placeholder="Número da Conta..." [(ngModel)]="accountNumber" />
                <button class="btn-filter" (click)="getFilter()">
                    <i class="bi bi-search"></i> Filtrar
                </button>
                <button class="btn-filter" (click)="clear()">
                    <i class="bi bi-brush"></i> Limpar
                </button>
            </div>
        </div>

        <!-- PAINEL DA TABELA -->
        <div class="panel panel-table">
            <h2>Relatório COSIF</h2>

            <table>
                <thead>
                    <tr>
                        <th>Mês/Ano</th>
                        <th>Arquivo</th>
                        <th>Número Oficial</th>
                        <th>Valor</th>
                        <th>Conta</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of paginatedData">
                        <td>{{ item.mounthKey }}</td>
                        <td>{{ item.fileName }}</td>
                        <td>{{ item.officialNumber }}</td>
                        <td>{{ item.among | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</td>
                        <td>{{ item.accountKey }}</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" class="table-footer">
                            Total de registros: {{ data?.length || 0 }}
                        </td>
                    </tr>
                </tfoot>
            </table>

            <!-- PAGINAÇÃO -->
            <div class="pagination">
                <button [disabled]="currentPage === 1" (click)="goToPreviousPage()">← Anterior</button>
                <span>Página {{ currentPage }} de {{ pages.length }}</span>
                <button [disabled]="currentPage === pages.length" (click)="goToNextPage()">Próximo →</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL DE USUÁRIO -->
<app-update-user (onSubmit)="onSubmitUpdateUser($event)"></app-update-user>
<!-- Modal de Confirmação -->
<div class="modal fade" id="confirmOverwriteModal" tabindex="-1" aria-labelledby="confirmOverwriteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="confirmOverwriteModalLabel">Confirmação</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        {{ overwriteMessage }}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeOverwriteModal()">Cancelar</button>
        <button type="button" class="btn btn-danger" (click)="confirmOverwrite()">Sobrescrever</button>
      </div>
    </div>
  </div>
</div>